{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Gameweek Predictions</h2>
    </div>
    <div class="card-body">
        {% if error.is_some() %}
        <div class="alert alert-danger">{{ error.as_ref().unwrap() }}</div>
        {% endif %}

        {% if has_gameweek %}
        {% let gameweek = current_gameweek.as_ref().unwrap() %}
        <div class="alert alert-info">
            <strong>{{ gameweek.season }} - Gameweek {{ gameweek.week_number }}</strong><br>
            Deadline: {{ gameweek.deadline.format("%A, %B %d, %Y at %I:%M %p") }}
            {% if deadline_passed %}
            <br><span style="color: #dc3545; font-weight: bold;">⚠️ Deadline has passed</span>
            {% endif %}
        </div>

        {# Handle submission status #}
        {% if already_submitted %}
            {% if deadline_passed %}
                <div class="alert alert-info">
                    Your predictions have been submitted and the deadline has passed.
                </div>
            {% else %}
                <div class="alert alert-success">
                    ✅ You have already submitted your predictions for this gameweek. You can update them until the deadline.
                </div>
            {% endif %}
        {% endif %}

        {# Fixtures display #}
        {% if !fixtures_with_predictions.is_empty() %}
        {% if !deadline_passed %}
        <form method="post" action="/predictions/submit">
            {% endif %}

            <div class="fixtures-grid">
                {% for fixture in fixtures_with_predictions %}
                <div class="card mb-3">
                    <!-- Your fixture display code here -->
                </div>
                {% endfor %}
            </div>

            {% if !deadline_passed %}
            <div class="text-center mt-3">
                <button type="submit" class="btn btn-primary">
                    {% if already_submitted %}Update Predictions{% else %}Submit Predictions{% endif %}
                </button>
            </div>
        </form>
        {% endif %}
        {% else %}
        <div class="alert alert-info">
            No fixtures have been set up for this gameweek yet.
        </div>
        {% endif %}
        {% else %}
        <div class="alert alert-info">
            No active gameweek found. Check back later!
        </div>
        {% endif %}
    </div>
</div>

<style>
    .fixtures-grid {
        display: grid;
        gap: 1rem;
    }

    .fixture-match {
        text-align: center;
    }

    .teams {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .team {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
    }

    .vs {
        font-weight: bold;
        font-size: 1.2rem;
        margin: 0 1rem;
        color: #6c757d;
    }

    .score-input {
        width: 80px;
        text-align: center;
        font-size: 1.1rem;
        font-weight: bold;
    }

    .score-display {
        width: 80px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 1.1rem;
        font-weight: bold;
    }

    .actual-result {
        margin-top: 1rem;
        padding: 0.5rem;
        background-color: #e9ecef;
        border-radius: 4px;
    }

    .points-awarded {
        font-weight: bold;
        color: #28a745;
        margin-top: 0.25rem;
    }

    @media (max-width: 768px) {
        .teams {
            flex-direction: column;
            gap: 1rem;
        }

        .vs {
            margin: 0;
            order: 2;
        }

        .team:first-child {
            order: 1;
        }

        .team:last-child {
            order: 3;
        }
    }
</style>
{% endblock %}