{% extends "base.html" %}

{% block content %}
<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <h2>Manage Gameweeks</h2>
      <a href="/admin" class="btn btn-secondary">Back to Dashboard</a>
    </div>
  </div>
  <div class="card-body">
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if success %}
    <div class="alert alert-success">{{ success }}</div>
    {% endif %}

    <!-- Create New Gameweek Form -->
    <div class="card mb-4">
      <div class="card-header">
        <h4>Create New Gameweek</h4>
      </div>
      <div class="card-body">
        <form method="post" action="/admin/gameweeks">
          <div class="form-row">
            <div class="form-group">
              <label for="week_number" class="form-label">Week Number</label>
              <input type="number"
                     id="week_number"
                     name="week_number"
                     class="form-control"
                     min="1"
                     max="38"
                     required>
            </div>

            <div class="form-group">
              <label for="season" class="form-label">Season</label>
              <input type="text"
                     id="season"
                     name="season"
                     class="form-control"
                     placeholder="e.g., 2024-25"
                     pattern="[0-9]{4}-[0-9]{2}"
                     required>
            </div>

            <div class="form-group">
              <label for="deadline" class="form-label">Deadline</label>
              <input type="datetime-local"
                     id="deadline"
                     name="deadline"
                     class="form-control"
                     required>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Create Gameweek</button>
        </form>
      </div>
    </div>

    <!-- Existing Gameweeks -->
    {% if gameweeks %}
    <div class="card">
      <div class="card-header">
        <h4>All Gameweeks</h4>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table">
            <thead>
            <tr>
              <th>Week</th>
              <th>Season</th>
              <th>Deadline</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for gameweek in gameweeks %}
            <tr {% if gameweek.is_active %}class="table-success"{% endif %}>
              <td>
                <strong>{{ gameweek.week_number }}</strong>
                {% if gameweek.is_active %}
                <span class="badge badge-success">ACTIVE</span>
                {% endif %}
              </td>
              <td>{{ gameweek.season }}</td>
              <td>{{ gameweek.deadline.format("%B %d, %Y<br>%I:%M %p")|safe }}</td>
              <td>
                {% if gameweek.is_completed %}
                <span class="badge badge-secondary">Completed</span>
                {% else if gameweek.is_active %}
                <span class="badge badge-success">Active</span>
                {% else %}
                <span class="badge badge-warning">Inactive</span>
                {% endif %}
              </td>
              <td>{{ gameweek.created_at.format("%m/%d/%Y") }}</td>
              <td>
                {% if gameweek.is_active %}
                <a href="/admin/fixtures" class="btn btn-sm btn-primary">Setup Fixtures</a>
                {% if not gameweek.is_completed %}
                <a href="/admin/results" class="btn btn-sm btn-secondary">Submit Results</a>
                {% endif %}
                {% endif %}
              </td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% else %}
    <div class="alert alert-info">
      No gameweeks created yet. Create your first gameweek above.
    </div>
    {% endif %}
  </div>
</div>

<style>
  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .table-success {
    background-color: rgba(40, 167, 69, 0.1);
  }

  .badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .badge-success {
    background-color: #28a745;
    color: white;
  }

  .badge-secondary {
    background-color: #6c757d;
    color: white;
  }

  .badge-warning {
    background-color: #ffc107;
    color: #212529;
  }

  .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    margin-right: 0.25rem;
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }

    .d-flex {
      flex-direction: column;
      gap: 1rem;
    }

    .table {
      font-size: 0.875rem;
    }

    .btn-sm {
      display: block;
      margin-bottom: 0.25rem;
      margin-right: 0;
    }
  }
</style>
{% endblock %}